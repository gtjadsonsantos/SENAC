# 1) TRIGGERS SQL 
 
SET SQL_SAFE_UPDATES = 0;
DROP DATABASE IF EXISTS DBESTATISTICA;
CREATE DATABASE DBESTATISTICA;
USE DBESTATISTICA;

CREATE TABLE PESSOA (
	IDPESSOA INT NOT NULL PRIMARY KEY AUTO_INCREMENT
	, NOME VARCHAR(45)
	, SEXO CHAR(1)
);

CREATE TABLE ESTATISTICA (	
	HOMEM INT
	, MULHER INT
);




DELIMITER $$

CREATE TRIGGER TR_PESSOA_AI AFTER INSERT ON PESSOA FOR EACH ROW
BEGIN 
	IF NEW.SEXO = "M" THEN
    	UPDATE ESTATISTICA
        SET HOMEM = HOMEM + 1;
    END IF;
    
    IF NEW.SEXO = "F" THEN
    	UPDATE ESTATISTICA
        SET MULHER = MULHER + 1;
    END IF;
END $$

CREATE TRIGGER TR_PESSOA_AD AFTER DELETE ON PESSOA FOR EACH ROW
BEGIN 
	IF OLD.SEXO = "M" THEN
    	UPDATE ESTATISTICA
        SET HOMEM = HOMEM - 1;
    END IF;
    
    IF OLD.SEXO = "F" THEN
    	UPDATE ESTATISTICA
        SET MULHER = MULHER - 1;
    END IF;
END $$


CREATE TRIGGER TR_PESSOA_AU AFTER UPDATE ON PESSOA FOR EACH ROW
BEGIN
	IF NEW.SEXO = "M" THEN
    	UPDATE ESTATISTICA
        SET HOMEM = HOMEM + 1;
    END IF;
    
    IF NEW.SEXO = "F" THEN
    	UPDATE ESTATISTICA
        SET MULHER = MULHER + 1;
    END IF;
    
    IF OLD.SEXO = "M" THEN
    	UPDATE ESTATISTICA
        SET HOMEM = HOMEM - 1;
    END IF;
    
    IF OLD.SEXO = "F" THEN
    	UPDATE ESTATISTICA
        SET MULHER = MULHER - 1;
    END IF;
    
END $$
DELIMITER ;

INSERT INTO ESTATISTICA (HOMEM,MULHER)VALUES(0,0);

INSERT INTO PESSOA (NOME,SEXO)VALUES("JADSON","M");
INSERT INTO PESSOA (NOME,SEXO)VALUES("BRUNA","F");
INSERT INTO PESSOA (NOME,SEXO)VALUES("CASSIA","F");


